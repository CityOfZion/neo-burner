{"ast":null,"code":"\"use strict\";\n\nfunction pushBits(arr, n, value) {\n  for (var bit = 1 << n - 1; bit; bit = bit >>> 1) {\n    arr.push(bit & value ? 1 : 0);\n  }\n} // {{{1 8bit encode\n\n\nfunction encode_8bit(data) {\n  var len = data.length;\n  var bits = [];\n\n  for (var i = 0; i < len; i++) {\n    pushBits(bits, 8, data[i]);\n  }\n\n  var res = {};\n  var d = [0, 1, 0, 0];\n  pushBits(d, 16, len);\n  res.data10 = res.data27 = d.concat(bits);\n\n  if (len < 256) {\n    var d = [0, 1, 0, 0];\n    pushBits(d, 8, len);\n    res.data1 = d.concat(bits);\n  }\n\n  return res;\n} // {{{1 alphanumeric encode\n\n\nvar ALPHANUM = function (s) {\n  var res = {};\n\n  for (var i = 0; i < s.length; i++) {\n    res[s[i]] = i;\n  }\n\n  return res;\n}('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:');\n\nfunction encode_alphanum(str) {\n  var len = str.length;\n  var bits = [];\n\n  for (var i = 0; i < len; i += 2) {\n    var b = 6;\n    var n = ALPHANUM[str[i]];\n\n    if (str[i + 1]) {\n      b = 11;\n      n = n * 45 + ALPHANUM[str[i + 1]];\n    }\n\n    pushBits(bits, b, n);\n  }\n\n  var res = {};\n  var d = [0, 0, 1, 0];\n  pushBits(d, 13, len);\n  res.data27 = d.concat(bits);\n\n  if (len < 2048) {\n    var d = [0, 0, 1, 0];\n    pushBits(d, 11, len);\n    res.data10 = d.concat(bits);\n  }\n\n  if (len < 512) {\n    var d = [0, 0, 1, 0];\n    pushBits(d, 9, len);\n    res.data1 = d.concat(bits);\n  }\n\n  return res;\n} // {{{1 numeric encode\n\n\nfunction encode_numeric(str) {\n  var len = str.length;\n  var bits = [];\n\n  for (var i = 0; i < len; i += 3) {\n    var s = str.substr(i, 3);\n    var b = Math.ceil(s.length * 10 / 3);\n    pushBits(bits, b, parseInt(s, 10));\n  }\n\n  var res = {};\n  var d = [0, 0, 0, 1];\n  pushBits(d, 14, len);\n  res.data27 = d.concat(bits);\n\n  if (len < 4096) {\n    var d = [0, 0, 0, 1];\n    pushBits(d, 12, len);\n    res.data10 = d.concat(bits);\n  }\n\n  if (len < 1024) {\n    var d = [0, 0, 0, 1];\n    pushBits(d, 10, len);\n    res.data1 = d.concat(bits);\n  }\n\n  return res;\n} // {{{1 url encode\n\n\nfunction encode_url(str) {\n  var slash = str.indexOf('/', 8) + 1 || str.length;\n  var res = encode(str.slice(0, slash).toUpperCase(), false);\n\n  if (slash >= str.length) {\n    return res;\n  }\n\n  var path_res = encode(str.slice(slash), false);\n  res.data27 = res.data27.concat(path_res.data27);\n\n  if (res.data10 && path_res.data10) {\n    res.data10 = res.data10.concat(path_res.data10);\n  }\n\n  if (res.data1 && path_res.data1) {\n    res.data1 = res.data1.concat(path_res.data1);\n  }\n\n  return res;\n} // {{{1 Choose encode mode and generates struct with data for different version\n\n\nfunction encode(data, parse_url) {\n  var str;\n  var t = typeof data;\n\n  if (t == 'string' || t == 'number') {\n    str = '' + data;\n    data = new Buffer(str);\n  } else if (Buffer.isBuffer(data)) {\n    str = data.toString();\n  } else if (Array.isArray(data)) {\n    data = new Buffer(data);\n    str = data.toString();\n  } else {\n    throw new Error(\"Bad data\");\n  }\n\n  if (/^[0-9]+$/.test(str)) {\n    if (data.length > 7089) {\n      throw new Error(\"Too much data\");\n    }\n\n    return encode_numeric(str);\n  }\n\n  if (/^[0-9A-Z \\$%\\*\\+\\.\\/\\:\\-]+$/.test(str)) {\n    if (data.length > 4296) {\n      throw new Error(\"Too much data\");\n    }\n\n    return encode_alphanum(str);\n  }\n\n  if (parse_url && /^https?:/i.test(str)) {\n    return encode_url(str);\n  }\n\n  if (data.length > 2953) {\n    throw new Error(\"Too much data\");\n  }\n\n  return encode_8bit(data);\n} // {{{1 export functions\n\n\nmodule.exports = encode;","map":null,"metadata":{},"sourceType":"script"}